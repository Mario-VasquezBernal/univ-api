// postgresql en .env -> DATABASE_URL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum DiaSemana {
  LUNES
  MARTES
  MIERCOLES
  JUEVES
  VIERNES
  SABADO
  DOMINGO
}

enum Turno {
  MATUTINO
  VESPERTINO
  NOCTURNO
}

model Alumno {
  id          Int          @id @default(autoincrement())
  dni         String       @unique
  nombres     String
  apellidos   String
  email       String       @unique
  telefono    String?
  carreraId   Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  carrera     Carrera      @relation(fields: [carreraId], references: [id])
  matriculas  Matricula[]

  @@index([carreraId])
}

model Carrera {
  id        Int        @id @default(autoincrement())
  nombre    String
  codigo    String     @unique

  alumnos   Alumno[]
  materias  Materia[]
}

model Ciclo {
  id        Int        @id @default(autoincrement())
  numero    Int        // 1..n
  nombre    String?    // opcional: "Primer ciclo", etc.

  materias  Materia[]

  @@unique([numero])
}

model Materia {
  id          Int        @id @default(autoincrement())
  nombre      String
  codigo      String     @unique
  creditos    Int
  horas       Int
  carreraId   Int
  cicloId     Int

  carrera     Carrera    @relation(fields: [carreraId], references: [id])
  ciclo       Ciclo      @relation(fields: [cicloId], references: [id])
  cursos      Curso[]

  @@index([carreraId])
  @@index([cicloId])
}

model Profesor {
  id        Int        @id @default(autoincrement())
  nombres   String
  apellidos String
  email     String      @unique
  titulo    String?     // opcional

  cursos    Curso[]
}

model Curso {
  id          Int         @id @default(autoincrement())
  materiaId   Int
  profesorId  Int
  seccion     String       // p.ej. "A", "B", "N1"
  turno       Turno
  cupo        Int          @default(40)
  activo      Boolean      @default(true)

  materia     Materia      @relation(fields: [materiaId], references: [id])
  profesor    Profesor     @relation(fields: [profesorId], references: [id])
  horarios    Horario[]
  matriculas  Matricula[]

  @@index([materiaId])
  @@index([profesorId])
  @@unique([materiaId, seccion]) // misma materia no repite sección
}

model Horario {
  id        Int        @id @default(autoincrement())
  cursoId   Int
  dia       DiaSemana
  horaInicio  String   // "08:00"
  horaFin     String   // "10:00"
  aula      String?

  curso     Curso      @relation(fields: [cursoId], references: [id])

  @@index([cursoId])
}

model Matricula {
  id          Int      @id @default(autoincrement())
  alumnoId    Int
  cursoId     Int
  fecha       DateTime @default(now())
  estado      String   @default("ACTIVA") // ACTIVA | RETIRADA | APROBADA | REPROBADA, etc.

  alumno      Alumno   @relation(fields: [alumnoId], references: [id])
  curso       Curso    @relation(fields: [cursoId], references: [id])

  @@unique([alumnoId, cursoId]) // evita duplicar matrícula del mismo alumno al mismo curso
  @@index([alumnoId])
  @@index([cursoId])
}
model Usuario {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  nombre    String?
  role      String   @default("ADMIN")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
